<DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SEÑOR AREPA </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>



</head>

<body class="bg-yellow-50 font-sans">

  <!-- Navegación -->
  <nav class="bg-yellow-400 p-4 flex justify-between items-center text-white font-bold text-lg">
  <div class="flex items-center space-x-2">
    <img src="imagenes/señora.png" alt="Logo Señor Arepa" class="w-20 h-20 rounded-full">
    <span class="text-xl">SEÑOR AREPA</span>
  </div>
  <div class="flex space-x-2">
  <a href="finanzas1.html" class="bg-white text-yellow-700 font-semibold px-3 py-1 rounded-lg shadow hover:bg-yellow-100 transition" target="_blank">
    📋 Finanzas
  </a>
  <a href="inventario.html" class="bg-yellow-600 text-white font-semibold px-3 py-1 rounded-lg shadow hover:bg-yellow-700 transition" target="_blank">
    📆 Inventario
  </a>
</div>
</nav>



  <!-- Sección Productos -->
  <main class="p-6">
    <h2 class="text-2xl font-bold text-gray-700 mb-4">Menú</h2>
    <div id="productos" class="grid grid-cols-1 md:grid-cols-3 gap-4">
     <!-- Comida -->
<div class="bg-white p-4 rounded-xl shadow-md">
  <h3 class="text-xl font-semibold text-yellow-600 mb-2">Comida</h3>
  <div class="grid grid-cols-2 gap-2">

    <button onclick="agregarProducto('AREPA PAISA', 17000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ PAISA - $17.000</button>

    <button onclick="agregarProducto('AREPA CHICHARRON', 14000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ CHICHARRON - $14.000</button>

    <button onclick="agregarProducto('AREPA EXTRA QUESILLO', 9000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ EXTRA QUESILLO - $9.000</button>

    <button onclick="agregarProducto('AREPA SEÑOR AREPA', 14000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ SEÑOR AREPA - $14.000</button>

    <button onclick="agregarProducto('AREPA SEÑORA AREPA', 14000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ SEÑORA AREPA - $14.000</button>

    <button onclick="agregarProducto('AREPA HAWAIANA', 14000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ HAWAIANA - $14.000</button>

    <button onclick="agregarProducto('AREPA MEGAPAISA', 22000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ MEGAPAISA- $22.000</button>

    <button onclick="agregarProducto('AREPA MIXTA', 14000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ MIXTA - $14.000</button>

    <button onclick="agregarProducto('AREPA RANCHERA', 14000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ RANCHERA - $14.000</button>

    <button onclick="agregarProducto('AREPA SOLO POLLO', 15000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ SOLO POLLO - $15.000</button>

    <button onclick="agregarProducto('AREPA SOLO CARNE', 15000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ SOLO CARNE - $15.000</button>

    <button onclick="agregarProducto('AREPA MEXICANA', 15000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ MEXICANA - $15.000</button>

    <button onclick="agregarProducto('AREPA SOLA', 1000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">⚪ AREPA SOLA - $1.000</button> 



  </div>
</div>

     <!-- Adiciones -->
<div class="bg-white p-4 rounded-xl shadow-md">
  <h3 class="text-xl font-semibold text-yellow-600 mb-2">Adiciones</h3>
  <div class="grid grid-cols-2 gap-2">
    <button onclick="agregarProducto('ADICION QUESO EXTRA', 5000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🧀 Queso Extra - $5.000</button>
    
    <button onclick="agregarProducto('ADICION MAIZ TIERNO', 3000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🌽 MAIZ TIERNO - $3.000</button>

    <button onclick="agregarProducto('ADICION PIÑA CALADA', 5000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🍍 PIÑA CALADA - $5.000</button>

    <button onclick="agregarProducto('ADICION POLLO', 7000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🍗 POLLO - $7.000</button>

    <button onclick="agregarProducto('ADICION CARNE', 7000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥩 CARNE - $7.000</button>

    <button onclick="agregarProducto('ADICION CHICHARRON', 6000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🍖 CHICHARRON - $6.000</button>

    <button onclick="agregarProducto('ADICION RANCHERA', 7000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🔥 RANCHERA - $7.000</button>

    <button onclick="agregarProducto('ADICION CHORIZO', 7000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🌭 CHORIZO - $7.000</button>

    <button onclick="agregarProducto('ADICION TOCINETA', 7000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥓 TOCINETA - $7.000</button>

    <button onclick="agregarProducto('ADICION MADURO', 3000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🍌  MADURO - $3.000</button>

    <button onclick="agregarProducto('ADICION ARMA TU AREPA X5', 25000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🍌 ARMA TU AREPA - $25.000</button>

  </div>
</div>

      

      <!-- Bebidas -->
     <div class="bg-white p-4 rounded-xl shadow-md">
         <h3 class="text-xl font-semibold text-yellow-600 mb-2">Bebidas</h3>
        <div class="grid grid-cols-2 gap-2">

           <button onclick="agregarProducto('QUATRO', 4000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🍋 QUATRO - $4.000</button>

           <button onclick="agregarProducto('COCA COLA', 4000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 COCA COLA - $4.000</button>

           <button onclick="agregarProducto('JUGO HIT', 4000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 JUGO HIT - $4.000</button>

           <button onclick="agregarProducto('SPRITE', 4000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 SPRITE - $4.000</button>

           <button onclick="agregarProducto('COCA COLA ZERO', 4000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 COCA COLA CERO - $4.000</button>

           <button onclick="agregarProducto('BRISA LIMON', 4000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 BRISA LIMON - $4.000</button>

           <button onclick="agregarProducto('BRISA MANZANA', 4000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">💧 BRISA MANZANA - $4.000</button>

           <button onclick="agregarProducto('FUZE TEA', 4000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 FUZE TEA - $4.000</button>

           <button onclick="agregarProducto('AGUA CON GAS', 4000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 AGUA CON GAS - $4.000</button>

           <button onclick="agregarProducto('AGUA SABORISADA', 4000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 AGUA SABORISADA - $4.000</button>


           
           <button onclick="agregarProducto('POSTOBON 400', 4000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 POSTOBON 400 - $4.000</button>

           <button onclick="agregarProducto('POSTOBON 1.5', 9000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 POSTOBON 1.5 - $9.000</button>


           <button onclick="agregarProducto('SODA BRETAÑA', 4500)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 SODA BRETAÑA - $4.000</button>

           <button onclick="agregarProducto('GATORADE', 6000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 GATORADE - $6.000</button>

           


           <button onclick="agregarProducto('COCA COLA 1L', 6500)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 COCA COLA 1L - $6.500</button>

           <button onclick="agregarProducto('QUATRO 1.5L', 9000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 QUATRO 1.5L - $9.000</button>

           <button onclick="agregarProducto('COCA COLA PREMIO 1.5L', 9000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 COCA COLA  1.5L - $9.000</button>

           <button onclick="agregarProducto('JUGO HIT 1.5L', 9000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 JUGO HIT 1.L - $7.000</button>

           <button onclick="agregarProducto('SPRITE 1.5L', 9000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 SPRITE 1.5L - $9.000</button>

           <button onclick="agregarProducto('COCA COLA ZERO 1.5L', 9000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 COCA COLA ZERO 1.5L - $9.000</button>

           <button onclick="agregarProducto(' AGUA', 3000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥤 AGUA - $3.000</button>

           <button onclick="agregarProducto('MILO CALIENTE', 6000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🥛 MILO CALIENTE - $6.000</button>

           <button onclick="agregarProducto('CAFE CON LECHE', 5000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">☕🥛 CAFE CON LECHE - $5.000</button>

           <button onclick="agregarProducto('TINTO', 4000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">☕ TINTO - $4.000</button>

           <button onclick="agregarProducto('CERVEZA', 6000)" class="bg-yellow-300 hover:bg-yellow-400 p-2 rounded">🍺 CERVEZA - $6.000</button>

        </div>
    </div>
    </div>



    <!-- Detalle de Pedido -->
    <div class="mt-6 bg-white p-4 rounded-xl shadow-md">
      <h3 class="text-lg font-semibold mb-4 border-b pb-2">🛒 Pedido Actual</h3>
      <ul id="listaPedido" class="list-disc pl-5 text-gray-700 space-y-1"></ul>
      <p id="total" class="mt-4 font-bold text-lg text-gray-800">Total: $0</p>
    </div>

    <!-- Cliente y forma de pago -->
    <div class="mt-4 flex flex-col md:flex-row gap-4">
      <input type="text" id="cliente" placeholder="Nombre del Cliente" class="flex-1 p-2 border border-yellow-300 rounded" />
      <input type="text" id="observaciones" placeholder="Observaciones (Ej: Sin cebolla, agregar salsas, etc.)" class="flex-1 p-2 border border-yellow-300 rounded" />


      <select id="formaPago" class="flex-1 p-2 border border-yellow-300 rounded">
        <option value="">Seleccione forma de pago</option>
        <option value="Efectivo">Efectivo</option>
        <option value="Tarjeta">Tarjeta</option>
        <option value="Transferencia">Transferencia</option>
        <option value="Nequi/Daviplata">Nequi/Daviplata</option>
      </select>
    </div>

    <!-- Tipo de pedido: Local o Domicilio -->
<div class="mt-4">
  <label for="tipoPedido" class="block text-sm font-medium text-gray-700">Tipo de Pedido</label>
  <select id="tipoPedido" class="mt-1 p-2 border rounded w-full">
    <option value="">Selecciona</option>
    <option value="Aquí">Aquí</option>
    <option value="Para llevar">Para llevar</option>
    <option value="Domicilio">Domicilio</option>
  </select>
</div>


    <!-- Botones de acción -->
    <div class="mt-6 flex flex-wrap gap-2">
      <button onclick="guardarVenta()" class="bg-green-500 hover:bg-green-600 text-white p-2 rounded">💾 Guardar Venta</button>
      <button onclick="imprimirUltimaCocinero()" class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded">🖨️ Imprimir para Cocina</button>
      <button onclick="imprimirUltimaCliente()" class="bg-purple-500 hover:bg-purple-600 text-white p-2 rounded">🧾 Imprimir Recibo Cliente</button>
     <button onclick="exportarVentasExcelConEstilo()" class="bg-green-600 hover:bg-green-700 text-white p-2 rounded">
      📊 Exportar Ventas a Excel
     </button>

      <button onclick="borrarVentas()" class="bg-red-500 hover:bg-red-600 text-white p-2 rounded">🗑️ Borrar Ventas</button>
      <button onclick="generarResumenProductos()" class="bg-indigo-500 hover:bg-indigo-600 text-white p-2 rounded">📊 Ver Resumen Productos</button>
    </div>

    <!-- Visualización de Ventas Guardadas -->
    <div id="ventasSeccion" class="mt-8 bg-white p-4 rounded-xl shadow-md">
  <h3 class="text-lg font-semibold mb-2">Ventas Guardadas</h3>

  <div class="mb-4">
  <input type="text" id="filtroCliente" oninput="filtrarVentasPorCliente()" placeholder="🔍 Filtrar por cliente..." class="w-full md:w-1/3 p-2 border border-yellow-300 rounded" />
  </div>

  <table class="min-w-full text-left border">
    <thead>
      <tr class="bg-yellow-200">
        <th class="p-2 border">#</th>
        <th class="p-2 border">Fecha</th>
        <th class="p-2 border">Cliente</th>
        <th class="p-2 border">Forma de Pago</th>
        <th class="p-2 border">Tipo de Pedido</th>
        <th class="p-2 border">Productos</th>
        <th class="p-2 border">Total</th>
      </tr>
    </thead>
    <tbody id="ventasGuardadas" class="text-sm text-gray-800"></tbody>
  </table>
</div>

    <!-- Resumen Productos -->
    <div id="resumenProductos" class="mt-8 bg-white p-4 rounded-xl shadow-md hidden">
      <h3 class="text-lg font-semibold mb-2">Resumen de Productos Vendidos</h3>
      <ul id="listaResumen" class="list-disc pl-5 text-gray-700 space-y-1"></ul>
    </div>
  </main>

  <script>
      let pedido = [];
  let total = 0;

  // Agrega un producto al pedido y actualiza la vista
  function agregarProducto(nombre, precio) {
    pedido.push({ nombre, precio });
    actualizarTotal();
    actualizarVistaPedido();
  }

  // Quita un producto del pedido por índice
  function quitarProducto(index) {
    if (index >= 0 && index < pedido.length) {
      pedido.splice(index, 1);
      actualizarTotal();
      actualizarVistaPedido();
    }
  }

  // Recalcula el total sumando todos los precios
  function actualizarTotal() {
    total = pedido.reduce((acc, p) => acc + p.precio, 0);
  }

  // Actualiza la lista del pedido en la interfaz
  function actualizarVistaPedido() {
    const lista = document.getElementById("listaPedido");
    lista.innerHTML = "";
    pedido.forEach((p, i) => {
      const li = document.createElement("li");
      li.innerHTML = `${p.nombre} - $${p.precio.toLocaleString('es-CO')} <button onclick="quitarProducto(${i})" class='text-red-600 ml-2'>❌</button>`;
      lista.appendChild(li);
    });
    document.getElementById("total").textContent = `Total: $${total.toLocaleString('es-CO')}`;
  }

  // Limpia el pedido y el formulario cliente/pago
  function limpiarPedido() {
    pedido = [];
    total = 0;
    actualizarVistaPedido();
    document.getElementById("cliente").value = "";
    document.getElementById("formaPago").value = "";
    document.getElementById("tipoPedido").value = "";
  }

  // Guarda la venta en localStorage y actualiza la vista de ventas
  function guardarVenta() {
    const cliente = document.getElementById("cliente").value.trim();
    const formaPago = document.getElementById("formaPago").value;
    const tipoPedido = document.getElementById("tipoPedido").value;

    if (pedido.length === 0) {
      alert("Agrega productos al pedido.");
      return;
    }
    if (!cliente) {
      alert("Por favor ingresa el nombre del cliente.");
      return;
    }
    if (!formaPago) {
      alert("Por favor selecciona una forma de pago.");
      return;
    }
    if (!tipoPedido) {
      alert("Por favor selecciona un tipo de pedido.");
      return;
    }

    const observaciones = document.getElementById("observaciones").value.trim();

       const venta = {
          cliente,
          formaPago,
          tipoPedido,
          observaciones,
          pedido: [...pedido],
          total,
          fecha: new Date().toLocaleString()
        };

    const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
    ventas.push(venta);
    localStorage.setItem("ventas", JSON.stringify(ventas));

    alert("Venta guardada exitosamente.");
    limpiarPedido();
    mostrarVentas();
    document.getElementById("resumenProductos").classList.add("hidden");
  }

  // Muestra las ventas guardadas en la tabla
  function mostrarVentas() {
  	document.getElementById("filtroCliente").value = "";

    const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
    const contenedor = document.getElementById("ventasGuardadas");
    contenedor.innerHTML = "";
    ventas.forEach((v, i) => {
      const resumen = {};
      v.pedido.forEach(p => {
        resumen[p.nombre] = (resumen[p.nombre] || 0) + 1;
      });
      const productosResumen = Object.entries(resumen)
        .map(([prod, cant]) => `${prod}: ${cant}`)
        .join("<br>");
      contenedor.innerHTML += `
  <tr>
    <td class='border p-1'>${i + 1}</td>
    <td class='border p-1'>${v.fecha}</td>
    <td class='border p-1'>${v.cliente}</td>
    <td class='border p-1'>${v.formaPago}</td>
    <td class='border p-1'>${v.tipoPedido}</td>
    <td class='border p-1'>${productosResumen}</td>
    <td class='border p-1'>$${v.total.toLocaleString('es-CO')}</td>
    <td class='border p-1 space-y-1 space-x-1'>
      <button onclick="imprimirVentaCliente(${i})" class="bg-purple-500 text-white px-2 py-1 rounded text-xs">🧾 Cliente</button>
      <button onclick="imprimirVentaCocina(${i})" class="bg-blue-500 text-white px-2 py-1 rounded text-xs">👨‍🍳 Cocina</button>
      <button onclick="editarVenta(${i})" class="bg-yellow-600 text-white px-2 py-1 rounded text-xs">📝 Editar</button>
    </td>
  </tr>
`;

    });
  }

  // Borra todas las ventas guardadas
  function borrarVentas() {
    if (confirm("¿Estás seguro de borrar todas las ventas?")) {
      localStorage.removeItem("ventas");
      alert("Todas las ventas han sido eliminadas.");
      mostrarVentas();
      const resumen = document.getElementById("resumenProductos");
      if (resumen) resumen.classList.add("hidden");
    }
  }

  // Genera resumen de productos vendidos
  function generarResumenProductos() {
    const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
    const resumen = {};
    ventas.forEach(v => {
      v.pedido.forEach(p => {
        resumen[p.nombre] = (resumen[p.nombre] || 0) + 1;
      });
    });
    const lista = document.getElementById("listaResumen");
    lista.innerHTML = "";
    Object.entries(resumen).forEach(([producto, cantidad]) => {
      const li = document.createElement("li");
      li.textContent = `${producto}: ${cantidad}`;
      lista.appendChild(li);
    });
    document.getElementById("resumenProductos").classList.remove("hidden");
    document.getElementById("resumenProductos").scrollIntoView({ behavior: "smooth" });
  }

  // Exportar ventas a Excel con estilo y toda la info incluida
  async function exportarVentasExcelConEstilo() {
    const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
    if (ventas.length === 0) return alert("No hay ventas registradas.");

    const workbook = new ExcelJS.Workbook();
    const sheet = workbook.addWorksheet("Ventas del Día");

    // Encabezados
    const headers = [
      "#", "Fecha", "Cliente", "Forma de Pago", "Tipo de Pedido", "Producto", "Precio (COP)", "Total Venta (COP)"
    ];
    sheet.addRow(headers);

    let totalGlobal = 0;
    const conteoProductos = {};
    let rowIndex = 2;

    ventas.forEach((venta, i) => {
      const { fecha, cliente, formaPago, tipoPedido, total, pedido } = venta;
      totalGlobal += parseFloat(total) || 0;

      pedido.forEach(producto => {
        sheet.addRow([
          i + 1,
          fecha,
          cliente,
          formaPago,
          tipoPedido,
          producto.nombre,
          parseFloat(producto.precio),
          parseFloat(total)
        ]);

        // Conteo para más vendido
        conteoProductos[producto.nombre] = (conteoProductos[producto.nombre] || 0) + 1;

        rowIndex++;
      });
    });

    // Estilos encabezado
    sheet.getRow(1).eachCell(cell => {
      cell.fill = {
        type: "pattern",
        pattern: "solid",
        fgColor: { argb: "FF1F4E78" }  // azul oscuro
      };
      cell.font = { color: { argb: "FFFFFFFF" }, bold: true };
      cell.alignment = { vertical: "middle", horizontal: "center" };
      cell.border = {
        top: { style: "thin" }, bottom: { style: "thin" },
        left: { style: "thin" }, right: { style: "thin" }
      };
    });

    // Estilo para filas alternas
    for (let i = 2; i <= sheet.rowCount; i++) {
      const row = sheet.getRow(i);
      const isEven = i % 2 === 0;
      row.eachCell(cell => {
        cell.fill = {
          type: "pattern",
          pattern: "solid",
          fgColor: { argb: isEven ? "FFF2F2F2" : "FFFFFFFF" }
        };
        cell.border = {
          top: { style: "thin" }, bottom: { style: "thin" },
          left: { style: "thin" }, right: { style: "thin" }
        };
      });
    }

    // Formato moneda COP en columnas precio y total
    for (let i = 2; i <= sheet.rowCount; i++) {
      sheet.getRow(i).getCell(7).numFmt = '"$"#,##0';
      sheet.getRow(i).getCell(8).numFmt = '"$"#,##0';
    }

    // Total global
    sheet.addRow([]);
    const totalRow = sheet.addRow(["", "", "", "", "", "TOTAL DEL DÍA:", "", totalGlobal]);
    totalRow.getCell(8).numFmt = '"$"#,##0';
    totalRow.font = { bold: true };

    // Producto más vendido
    let productoMasVendido = "", maxCantidad = 0;
    for (const [prod, cantidad] of Object.entries(conteoProductos)) {
      if (cantidad > maxCantidad) {
        maxCantidad = cantidad;
        productoMasVendido = prod;
      }
    }
    const resumenRow = sheet.addRow(["", "", "", "", "", "Producto más vendido:", "", `${productoMasVendido} (${maxCantidad})`]);
    resumenRow.font = { italic: true };

    // Ajustar ancho columnas
    sheet.columns.forEach(col => {
      col.width = 18;
    });

    
    // Guardar Excel y descargar
const buffer = await workbook.xlsx.writeBuffer();
const blob = new Blob([buffer], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" });
const url = URL.createObjectURL(blob);
const a = document.createElement("a");
a.href = url;

// Corrección de la fecha local
const fechaLocal = new Date();
const yyyy = fechaLocal.getFullYear();
const mm = String(fechaLocal.getMonth() + 1).padStart(2, '0');
const dd = String(fechaLocal.getDate()).padStart(2, '0');
a.download = `Ventas_del_día_${yyyy}-${mm}-${dd}.xlsx`;

document.body.appendChild(a);
a.click();
a.remove();
URL.revokeObjectURL(url);

  }
    // Borra todas las ventas guardadas
    function imprimirUltimaCocinero() {
  const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
  if (ventas.length === 0) {
    alert("No hay ventas para imprimir.");
    return;
  }

  const ultimaVenta = ventas[ventas.length - 1];
  if (!ultimaVenta.pedido || !Array.isArray(ultimaVenta.pedido)) {
    alert("La última venta no tiene productos válidos.");
    return;
  }

  // Obtener observaciones del input
  const observaciones = document.getElementById('observaciones').value.trim();

  // Resumir productos
  const resumen = {};
  ultimaVenta.pedido.forEach(p => {
    resumen[p.nombre] = (resumen[p.nombre] || 0) + 1;
  });

  // Contenido del recibo para cocina, agregando observaciones solo si existen
  const contenido = `
    <!DOCTYPE html>
    <html>
    <head>
      <style>
        body {
          font-family: monospace;
          font-size: 15px;
          margin: 0;
          padding: 11px;
        }
        h2 {
          text-align: center;
          font-size: 19px;
          margin-bottom: 11px;
        }
        .info {
          margin-bottom: 10px;
        }
        .info p {
          margin: 2px 0;
        }
        ul {
          list-style: none;
          padding: 0;
          margin: 0;
        }
        li {
          padding: 4px 0;
          border-bottom: 2px dashed #000;
          font-size: 19px;
        }
      </style>
    </head>
    <body>
      <h2>🧾 PEDIDO A COCINA</h2>
      <div class="info">
        <p><strong>Cliente:</strong> ${ultimaVenta.cliente || "Sin nombre"}</p>
        <p><strong>Hora:</strong> ${ultimaVenta.fecha || "Sin hora"}</p>
        <p><strong>Tipo de Pedido:</strong> ${ultimaVenta.tipoPedido || "-"}</p>
        ${observaciones ? `<p><strong>Observaciones:</strong> ${observaciones}</p>` : ''}
      </div>
      <ul>
        ${Object.entries(resumen).map(([producto, cantidad]) => `<li>${producto} x${cantidad}</li>`).join("")}
      </ul>
      <p style="text-align: center; margin-top: 10px;">👨‍🍳 Preparar con cuidado</p>
    </body>
    </html>
  `;

  // Ventana para imprimir
  const w = window.open("", "_blank", "width=400,height=600");
  w.document.write(contenido);
  w.document.close();
  w.focus();
  w.print();
}




    // Imprimir último recibo para cliente (simple)
function imprimirUltimaCliente() {
  const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
  if (ventas.length === 0) {
    alert("No hay ventas para imprimir.");
    return;
  }

  const ultimaVenta = ventas[ventas.length - 1];
  const observaciones = document.getElementById("observaciones").value.trim();

  let contenido = `
    <html>
      <head>
        <title>Recibo Cliente</title>
        <style>
          body {
            font-family: monospace;
            font-size: 14px;
            width: 58mm;
            padding: 10px 12px;
            margin: 0;
            line-height: 1.5;
          }
          h2 {
            text-align: center;
            font-size: 19px;
            margin: 14px 0 5px;
            font-weight: bold;
          }
          .sub-info {
            text-align: center;
            font-size: 12px;
            margin-bottom: 10px;
            line-height: 1.3;
          }
          .line {
            border-top: 1px dashed #000;
            margin: 9px 0;
          }
          ul {
            list-style: none;
            padding: 0;
            margin: 0;
          }
          li {
            margin-bottom: 7px;
          }
          .total {
            text-align: right;
            font-weight: bold;
            margin-top: 14px;
            font-size: 16px;
          }
          .info p {
            margin: 6px 0;
          }
          .info strong {
            font-weight: bold;
          }
          p.thanks {
            text-align: center;
            margin-top: 22px;
            font-weight: bold;
            font-size: 15px;
          }
        </style>
      </head>
      <body>
        <h2>SEÑOR AREPA</h2>
        <div class="sub-info">
          Matrícula No 289546<br>
          CALLE 19#25-03 ESQUINA<br>
          BARRIO SAN JOSÉ, ARMENIA
        </div>
        <div class="line"></div>
        <div class="info">
          <p><strong>Cliente:</strong> ${ultimaVenta.cliente || "N/A"}</p>
          <p><strong>Fecha:</strong> ${ultimaVenta.fecha}</p>
          <p><strong>Tipo de Pedido:</strong> ${ultimaVenta.tipoPedido || "-"}</p>
          ${observaciones ? `<p><strong>Observaciones:</strong> ${observaciones}</p>` : ""}
        </div>
        <div class="line"></div>
        <ul>`;

  ultimaVenta.pedido.forEach(p => {
    contenido += `<li>${p.nombre} - $${p.precio}</li>`;
  });

  contenido += `
        </ul>
        <div class="line"></div>
        <p class="total">Total: $${ultimaVenta.total}</p>
        <div class="line"></div>
        <p class="thanks">¡Gracias por su compra!</p>
      </body>
    </html>`;

  const w = window.open("", "_blank", "width=400,height=600");
  w.document.write(contenido);
  w.document.close();
  w.focus();
  w.print();
}


// Imprimir cualquier recibo de la seccion ventas guardadas (simple)

function imprimirVentaCliente(index) {
  const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
  const venta = ventas[index];
  if (!venta) return alert("Venta no encontrada.");

  const contenido = `
    <html>
      <head>
        <title>Recibo Cliente</title>
        <style>
          body {
            font-family: monospace;
            font-size: 14px;
            width: 58mm;
            padding: 10px 12px;
            margin: 0;
            line-height: 1.5;
          }
          h2 {
            text-align: center;
            font-size: 19px;
            margin: 14px 0;
            font-weight: bold;
          }
          .line {
            border-top: 1px dashed #000;
            margin: 9px 0;
          }
          ul {
            list-style: none;
            padding: 0;
            margin: 0;
          }
          li {
            margin-bottom: 7px;
          }
          .total {
            text-align: right;
            font-weight: bold;
            margin-top: 14px;
            font-size: 16px;
          }
          .info p {
            margin: 6px 0;
          }
          .info strong {
            font-weight: bold;
          }
          p.thanks {
            text-align: center;
            margin-top: 22px;
            font-weight: bold;
            font-size: 15px;
          }
        </style>
      </head>
      <body>
        <h2>SEÑOR AREPA</h2>
        <div class="line"></div>
        <div class="info">
          <p><strong>Cliente:</strong> ${venta.cliente || "N/A"}</p>
          <p><strong>Fecha:</strong> ${venta.fecha}</p>
          <p><strong>Tipo de Pedido:</strong> ${venta.tipoPedido || "-"}</p>
          ${venta.observaciones ? `<p><strong>Observaciones:</strong> ${venta.observaciones}</p>` : ""}
        </div>
        <div class="line"></div>
        <ul>
          ${venta.pedido.map(p => `<li>${p.nombre} - $${p.precio}</li>`).join("")}
        </ul>
        <div class="line"></div>
        <p class="total">Total: $${venta.total}</p>
        <div class="line"></div>
        <p class="thanks">¡Gracias por su compra!</p>
      </body>
    </html>`;

  const w = window.open("", "_blank", "width=400,height=600");
  w.document.write(contenido);
  w.document.close();
  w.focus();
  w.print();
}

function imprimirVentaCocina(index) {
  const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
  const venta = ventas[index];
  if (!venta) return alert("Venta no encontrada.");

  const resumen = {};
  venta.pedido.forEach(p => {
    resumen[p.nombre] = (resumen[p.nombre] || 0) + 1;
  });

  const contenido = `
    <html>
      <head>
        <title>Pedido Cocina</title>
        <style>
          body {
            font-family: monospace;
            font-size: 15px;
            margin: 0;
            padding: 11px;
          }
          h2 {
            text-align: center;
            font-size: 19px;
            margin-bottom: 11px;
          }
          .info {
            margin-bottom: 10px;
          }
          .info p {
            margin: 2px 0;
          }
          ul {
            list-style: none;
            padding: 0;
            margin: 0;
          }
          li {
            padding: 4px 0;
            border-bottom: 2px dashed #000;
            font-size: 19px;
          }
        </style>
      </head>
      <body>
        <h2>🧾 PEDIDO A COCINA</h2>
        <div class="info">
          <p><strong>Cliente:</strong> ${venta.cliente || "Sin nombre"}</p>
          <p><strong>Hora:</strong> ${venta.fecha || "Sin hora"}</p>
          <p><strong>Tipo de Pedido:</strong> ${venta.tipoPedido || "-"}</p>
          ${venta.observaciones ? `<p><strong>Observaciones:</strong> ${venta.observaciones}</p>` : ""}
        </div>
        <ul>
          ${Object.entries(resumen).map(([producto, cantidad]) => `<li>${producto} x${cantidad}</li>`).join("")}
        </ul>
        <p style="text-align: center; margin-top: 10px;">👨‍🍳 Preparar con cuidado</p>
      </body>
    </html>`;

  const w = window.open("", "_blank", "width=400,height=600");
  w.document.write(contenido);
  w.document.close();
  w.focus();
  w.print();
}

function editarVenta(index) {
  const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
  const venta = ventas[index];
  if (!venta) return alert("Venta no encontrada.");

  // Cargar datos al formulario
  document.getElementById("cliente").value = venta.cliente;
  document.getElementById("formaPago").value = venta.formaPago;
  document.getElementById("tipoPedido").value = venta.tipoPedido;
  document.getElementById("observaciones").value = venta.observaciones || "";

  // Cargar productos
  pedido = [...venta.pedido];
  total = venta.total;
  actualizarVistaPedido();

  // Quitar la venta del localStorage para que se reemplace al guardar
  ventas.splice(index, 1);
  localStorage.setItem("ventas", JSON.stringify(ventas));

  mostrarVentas();
  alert("Venta cargada para edición. Haz los cambios y presiona 'Guardar Venta'.");
}


function filtrarVentasPorCliente() {
  const filtro = document.getElementById("filtroCliente").value.toLowerCase();
  const ventas = JSON.parse(localStorage.getItem("ventas")) || [];
  const contenedor = document.getElementById("ventasGuardadas");
  contenedor.innerHTML = "";

  ventas.forEach((v, i) => {
    if (!v.cliente.toLowerCase().includes(filtro)) return;

    const resumen = {};
    v.pedido.forEach(p => {
      resumen[p.nombre] = (resumen[p.nombre] || 0) + 1;
    });

    const productosResumen = Object.entries(resumen)
      .map(([prod, cant]) => `${prod}: ${cant}`)
      .join("<br>");

    contenedor.innerHTML += `
      <tr>
        <td class='border p-1'>${i + 1}</td>
        <td class='border p-1'>${v.fecha}</td>
        <td class='border p-1'>${v.cliente}</td>
        <td class='border p-1'>${v.formaPago}</td>
        <td class='border p-1'>${v.tipoPedido}</td>
        <td class='border p-1'>${productosResumen}</td>
        <td class='border p-1'>$${v.total.toLocaleString('es-CO')}</td>
        <td class='border p-1 space-y-1 space-x-1'>
          <button onclick="imprimirVentaCliente(${i})" class="bg-purple-500 text-white px-2 py-1 rounded text-xs">🧾 Cliente</button>
          <button onclick="imprimirVentaCocina(${i})" class="bg-blue-500 text-white px-2 py-1 rounded text-xs">👨‍🍳 Cocina</button>
          <button onclick="editarVenta(${i})" class="bg-yellow-600 text-white px-2 py-1 rounded text-xs">📝 Editar</button>
        </td>
      </tr>
    `;
  });
}



    window.onload = mostrarVentas;
  </script>
</body>
</html>
